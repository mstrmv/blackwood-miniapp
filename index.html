<!doctype html>
<html lang="uk">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>BLACKWOOD ‚Äî 5 –∫–≥</title>

  <link rel="stylesheet" href="css/style.css">
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>

<header class="header">
  <div class="h-title">BLACKWOOD üñ§</div>
  <div class="h-sub">
    <span class="chip">–í—É–≥—ñ–ª–ª—è ‚Ä¢ 5 –∫–≥</span>
    <span class="chip">–ù–æ–≤–∞ –ü–æ—à—Ç–∞</span>
    <span class="chip">–ù–∞–∫–ª–∞–¥–µ–Ω–∏–π –ø–ª–∞—Ç—ñ–∂</span>
  </div>
</header>

<main class="wrap">

  <section class="card">
    <div class="slider" id="slider">
      <img id="slideImg" class="slide" src="images/core_5_1.png" alt="BLACKWOOD CORE 5 –∫–≥">
      <div class="badge">5 –∫–≥</div>

      <button class="nav left" id="prevBtn">‚Äπ</button>
      <button class="nav right" id="nextBtn">‚Ä∫</button>

      <div class="dots">
        <button class="dot active" data-i="0"></button>
        <button class="dot" data-i="1"></button>
        <button class="dot" data-i="2"></button>
      </div>
    </div>

    <div class="body">
      <div class="name">BLACKWOOD CORE ‚Äî 5 –∫–≥</div>
      <div class="desc">–ë—Ä–∏–∫–µ—Ç–∏ –∑ —Ç–≤–µ—Ä–¥–∏—Ö –ø–æ—Ä—ñ–¥. –î–æ–≤–≥–µ –≥–æ—Ä—ñ–Ω–Ω—è ‚Ä¢ –ù–∏–∑—å–∫–∞ –∑–æ–ª—å–Ω—ñ—Å—Ç—å ‚Ä¢ –î–ª—è BBQ/–≥—Ä–∏–ª—è/–∫–æ–ø—á–µ–Ω–Ω—è</div>

      <div class="row">
        <div class="price"><span id="price">499</span> ‚Ç¥</div>

        <div class="qtybox">
          <button class="qbtn" id="minus">‚àí</button>
          <div class="qnum" id="qty">0</div>
          <button class="qbtn" id="plus">+</button>
        </div>
      </div>

      <button class="btn add" id="addBtn">–î–æ–¥–∞—Ç–∏ –≤ –∫–æ—à–∏–∫</button>
    </div>
  </section>

</main>

<footer class="bar">
  <div class="barin">
    <div class="sum">
      <div><b>–ö–æ—à–∏–∫:</b> <span id="cartCount">0</span> —à—Ç</div>
      <div>–°—É–º–∞: <b><span id="cartTotal">0</span> ‚Ç¥</b></div>
    </div>
    <button class="btn primary" id="openCheckout" disabled>–û—Ñ–æ—Ä–º–∏—Ç–∏</button>
  </div>
</footer>

<!-- Checkout modal -->
<div class="overlay" id="overlay">
  <div class="modal">
    <div class="mhead">
      <div class="mtitle">–û—Ñ–æ—Ä–º–ª–µ–Ω–Ω—è ‚Ä¢ –ù–æ–≤–∞ –ü–æ—à—Ç–∞</div>
      <button class="x" id="close">√ó</button>
    </div>

    <div class="mcontent">
      <div class="cartline">
        <div>
          <div class="lname">BLACKWOOD CORE ‚Äî 5 –∫–≥</div>
          <div class="lmeta">499 ‚Ç¥/—à—Ç ‚Ä¢ –í–∞–≥–∞: 5 –∫–≥</div>
        </div>
        <div class="lright">
          <span class="mini">–ö-—Ç—å:</span>
          <b id="mQty">0</b>
        </div>
      </div>

      <div class="totalbox">
        <div>–°—É–º–∞: <b><span id="mTotal">0</span> ‚Ç¥</b></div>
        <div>–í–∞–≥–∞: <b><span id="mKg">0</span> –∫–≥</b></div>
        <div>–û–ø–ª–∞—Ç–∞: <b>–Ω–∞–∫–ª–∞–¥–µ–Ω–∏–π –ø–ª–∞—Ç—ñ–∂</b></div>
      </div>

      <div class="form">
        <div class="grid2">
          <div>
            <label>–ü–Ü–ë *</label>
            <input id="fullName" placeholder="–ù–∞–ø—Ä. –¢–∏–º—É—Ä –Ü–≤–∞–Ω–æ–≤" />
          </div>
          <div>
            <label>–¢–µ–ª–µ—Ñ–æ–Ω * (+380‚Ä¶)</label>
            <input id="phone" placeholder="+380XXXXXXXXX" />
          </div>
        </div>

        <div class="grid2">
          <div>
            <label>–ú—ñ—Å—Ç–æ *</label>
            <input id="city" placeholder="–ù–∞–ø—Ä. –ö–∏—ó–≤" />
          </div>
          <div>
            <label>–¢–∏–ø –¥–æ—Å—Ç–∞–≤–∫–∏</label>
            <select id="npType">
              <option value="–í—ñ–¥–¥—ñ–ª–µ–Ω–Ω—è">–í—ñ–¥–¥—ñ–ª–µ–Ω–Ω—è</option>
              <option value="–ü–æ—à—Ç–æ–º–∞—Ç">–ü–æ—à—Ç–æ–º–∞—Ç</option>
              <option value="–ö—É—Ä º—î—Ä">–ö—É—Ä º—î—Ä (–∞–¥—Ä–µ—Å–∞)</option>
            </select>
          </div>
        </div>

        <div>
          <label id="npLabel">–ù–æ–º–µ—Ä –≤—ñ–¥–¥—ñ–ª–µ–Ω–Ω—è / –ø–æ—à—Ç–æ–º–∞—Ç—É *</label>
          <input id="npPoint" placeholder="–ù–∞–ø—Ä. 12" />
        </div>

        <div>
          <label>–ö–æ–º–µ–Ω—Ç–∞—Ä</label>
          <textarea id="comment" placeholder="–ù–µ–æ–±–æ–≤‚Äô—è–∑–∫–æ–≤–æ"></textarea>
        </div>

        <div class="warn" id="warn">–ó–∞–ø–æ–≤–Ω–∏ –æ–±–æ–≤ º—è–∑–∫–æ–≤—ñ –ø–æ–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ.</div>

        <div class="actions">
          <button class="btn ghost" id="clear">–û—á–∏—Å—Ç–∏—Ç–∏</button>
          <button class="btn primary" id="send">–ü—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è</button>
        </div>

        <div class="hint">
          –ü—ñ—Å–ª—è –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è –¥–∞–Ω—ñ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –Ω–∞–¥—ñ–π–¥—É—Ç—å —É –±–æ—Ç.
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  const tg = window.Telegram?.WebApp;
  if (tg) { tg.ready(); tg.expand(); }

  // ‚úÖ –ø–æ–º–µ–Ω—è–π —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –Ω–∞ .jpg –µ—Å–ª–∏ —É —Ç–µ–±—è jpg
  const SLIDES = [
    "images/core_5_1.png",
    "images/core_5_2.png",
    "images/core_5_3.png"
  ];

  const PRICE = 499;
  const WEIGHT_KG = 5;

  let slide = 0;
  let qty = 0;

  const slideImg = document.getElementById("slideImg");
  const dots = [...document.querySelectorAll(".dot")];

  function setSlide(i){
    slide = (i + SLIDES.length) % SLIDES.length;
    slideImg.src = SLIDES[slide];
    dots.forEach((d, idx) => d.classList.toggle("active", idx === slide));
  }

  document.getElementById("prevBtn").onclick = () => setSlide(slide - 1);
  document.getElementById("nextBtn").onclick = () => setSlide(slide + 1);
  dots.forEach(d => d.onclick = () => setSlide(Number(d.dataset.i)));

  function money(n){ return Number(n||0).toLocaleString("uk-UA"); }

  function sync(){
    document.getElementById("qty").textContent = qty;
    document.getElementById("cartCount").textContent = qty;
    document.getElementById("cartTotal").textContent = money(qty * PRICE);
    document.getElementById("openCheckout").disabled = qty === 0;

    // Telegram MainButton (–∫—Ä–∞—Å–∏–≤–æ)
    if (tg && tg.MainButton) {
      if (qty > 0) {
        tg.MainButton.setText(`–û—Ñ–æ—Ä–º–∏—Ç–∏ ‚Ä¢ ${money(qty * PRICE)} ‚Ç¥`).show();
        tg.MainButton.onClick(() => openModal());
      } else {
        tg.MainButton.hide();
      }
    }
  }

  document.getElementById("plus").onclick = () => { qty++; sync(); };
  document.getElementById("minus").onclick = () => { qty = Math.max(0, qty-1); sync(); };
  document.getElementById("addBtn").onclick = () => { qty = Math.max(1, qty); sync(); };

  const overlay = document.getElementById("overlay");
  function openModal(){
    overlay.style.display = "flex";
    document.getElementById("mQty").textContent = qty;
    document.getElementById("mTotal").textContent = money(qty * PRICE);
    document.getElementById("mKg").textContent = String(qty * WEIGHT_KG);
  }
  function closeModal(){ overlay.style.display = "none"; document.getElementById("warn").style.display = "none"; }

  document.getElementById("openCheckout").onclick = openModal;
  document.getElementById("close").onclick = closeModal;
  overlay.onclick = (e) => { if (e.target === overlay) closeModal(); };

  // NP label logic
  const npType = document.getElementById("npType");
  const npLabel = document.getElementById("npLabel");
  const npPoint = document.getElementById("npPoint");
  function updateNp(){
    if (npType.value === "–ö—É—Ä º—î—Ä") {
      npLabel.textContent = "–ê–¥—Ä–µ—Å–∞ –¥–æ—Å—Ç–∞–≤–∫–∏ *";
      npPoint.placeholder = "–ù–∞–ø—Ä. –≤—É–ª. –•—Ä–µ—â–∞—Ç–∏–∫ 10, –∫–≤ 5";
    } else {
      npLabel.textContent = "–ù–æ–º–µ—Ä –≤—ñ–¥–¥—ñ–ª–µ–Ω–Ω—è / –ø–æ—à—Ç–æ–º–∞—Ç—É *";
      npPoint.placeholder = "–ù–∞–ø—Ä. 12";
    }
  }
  npType.onchange = updateNp;
  updateNp();

  // Clear cart
  document.getElementById("clear").onclick = () => {
    qty = 0;
    closeModal();
    sync();
  };

  function isValidPhone(s){
    const t = (s||"").trim().replace(/\s+/g,"");
    return /^\+?380\d{9}$/.test(t);
  }

  // Send order to bot
  document.getElementById("send").onclick = () => {
    if (qty === 0) return;

    const full_name = document.getElementById("fullName").value.trim();
    const phone = document.getElementById("phone").value.trim();
    const city = document.getElementById("city").value.trim();
    const np_type = npType.value;
    const np_point = npPoint.value.trim();
    const comment = document.getElementById("comment").value.trim();

    const ok = full_name && city && np_point && isValidPhone(phone);
    const warn = document.getElementById("warn");
    warn.style.display = ok ? "none" : "block";
    if (!ok) return;

    const payload = {
      order_id: String(Date.now()),
      currency: "UAH",
      payment: "cod",
      items: [{
        id: "core_5",
        name: "BLACKWOOD CORE ‚Äî 5 –∫–≥",
        qty,
        price: PRICE,
        weight_kg: WEIGHT_KG
      }],
      total: qty * PRICE,
      total_kg: qty * WEIGHT_KG,
      delivery: { full_name, phone, city, np_type, np_point, comment }
    };

    if (!tg) {
      alert("–í—ñ–¥–∫—Ä–∏–π Mini App –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ Telegram —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫—É ¬´–ö–∞—Ç–∞–ª–æ–≥¬ª.");
      return;
    }
    tg.sendData(JSON.stringify(payload));
    tg.close();
  };

  // init
  setSlide(0);
  sync();
</script>

</body>
</html>
